<!-- prettier-ignore -->
{% extends "voice_recordings/layout.html" %}
{% block title %}
Storyworth:
{% if recording.status == "IN_PROGRESS" %}
Recording in progress...
{% elif recording.status == "COMPLETE" %}
Recording complete!
{% else %}
Recording failed
{% endif %}
{% endblock %}

<!-- prettier-ignore -->
{% block recorder %}
<div class="mt-8 flex items-center gap-4">
  {% if recording.status == "IN_PROGRESS" %}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke-width="1.5"
    stroke="#114739"
    class="size-10"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M20.25 3.75v4.5m0-4.5h-4.5m4.5 0-6 6m3 12c-8.284 0-15-6.716-15-15V4.5A2.25 2.25 0 0 1 4.5 2.25h1.372c.516 0 .966.351 1.091.852l1.106 4.423c.11.44-.054.902-.417 1.173l-1.293.97a1.062 1.062 0 0 0-.38 1.21 12.035 12.035 0 0 0 7.143 7.143c.441.162.928-.004 1.21-.38l.97-1.293a1.125 1.125 0 0 1 1.173-.417l4.423 1.106c.5.125.852.575.852 1.091V19.5a2.25 2.25 0 0 1-2.25 2.25h-2.25Z"
    />
  </svg>
  Call to {{ recording.phone_number }} in progress. When you have finished
  recording your story, just hang up.
  <!-- prettier-ignore -->
  {% elif recording.status == "COMPLETE" %}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke-width="1.5"
    stroke="#114739"
    class="size-10"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
    />
  </svg>
  Recording complete!
  <audio controls src="{{ recording.twilio_recording_url }}"></audio>
  <!-- prettier-ignore -->
  {% else %}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
    stroke-width="1.5"
    stroke="darkred"
    class="size-10"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M15.75 3.75 18 6m0 0 2.25 2.25M18 6l2.25-2.25M18 6l-2.25 2.25m1.5 13.5c-8.284 0-15-6.716-15-15V4.5A2.25 2.25 0 0 1 4.5 2.25h1.372c.516 0 .966.351 1.091.852l1.106 4.423c.11.44-.054.902-.417 1.173l-1.293.97a1.062 1.062 0 0 0-.38 1.21 12.035 12.035 0 0 0 7.143 7.143c.441.162.928-.004 1.21-.38l.97-1.293a1.125 1.125 0 0 1 1.173-.417l4.423 1.106c.5.125.852.575.852 1.091V19.5a2.25 2.25 0 0 1-2.25 2.25h-2.25Z"
    />
  </svg>
  Recording failed.
  <!-- prettier-ignore -->
  {% endif %}
</div>
{% endblock %}

<!-- prettier-ignore -->
{% block js %}
{% if recording.status == "IN_PROGRESS" %}
<script>
  // Poll for updates until the recording is complete, then refresh the page.
  // TODO: Implement using server-sent events or websockets.
  async function waitUntilComplete() {
    const response = await fetch("{% url 'recording_status' recording.pk %}");
    const status = await response.text();
    if (status === "COMPLETE") {
      location.reload();
    } else {
      setTimeout(waitUntilComplete, 2000);
    }
  }
  setTimeout(waitUntilComplete, 10000);
</script>
<!-- prettier-ignore -->
{% endif %}
{% endblock %}
